{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","../../../../src/lib/firebase/onboarding.ts","../../../../src/lib/firebase/pairing.ts","../../../../src/app/instances/connect/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","import { collection, doc, getDoc, getDocs, limit, query, setDoc, updateDoc } from 'firebase/firestore';\nimport type { User } from 'firebase/auth';\nimport { firestoreDb } from './client';\n\nfunction now() {\n  return Date.now();\n}\n\nfunction wid(uid: string) {\n  return `ws_${uid}`;\n}\n\nexport async function ensureUserAndWorkspace(user: User) {\n  const db = firestoreDb();\n  const userRef = doc(db, 'users', user.uid);\n  const userSnap = await getDoc(userRef);\n\n  if (!userSnap.exists()) {\n    const wsId = wid(user.uid);\n    const wsRef = doc(db, 'workspaces', wsId);\n\n    await setDoc(wsRef, {\n      id: wsId,\n      name: `${user.displayName ?? 'My'} Workspace`,\n      createdAt: now(),\n      updatedAt: now(),\n    });\n\n    await setDoc(doc(db, 'workspaces', wsId, 'members', user.uid), {\n      uid: user.uid,\n      role: 'owner',\n      createdAt: now(),\n    });\n\n    await setDoc(userRef, {\n      uid: user.uid,\n      email: user.email ?? null,\n      displayName: user.displayName ?? null,\n      photoURL: user.photoURL ?? null,\n      defaultWorkspaceId: wsId,\n      createdAt: now(),\n      updatedAt: now(),\n    });\n\n    return { defaultWorkspaceId: wsId };\n  }\n\n  const data = userSnap.data() as { defaultWorkspaceId?: string };\n  if (!data.defaultWorkspaceId) {\n    const wsId = wid(user.uid);\n    await updateDoc(userRef, { defaultWorkspaceId: wsId, updatedAt: now() });\n    return { defaultWorkspaceId: wsId };\n  }\n\n  return { defaultWorkspaceId: data.defaultWorkspaceId };\n}\n\nexport async function workspaceHasInstance(workspaceId: string): Promise<boolean> {\n  const db = firestoreDb();\n  const q = query(collection(db, 'workspaces', workspaceId, 'instances'), limit(1));\n  const snap = await getDocs(q);\n  return !snap.empty;\n}\n","import { addDoc, collection, doc, getDoc, updateDoc } from 'firebase/firestore';\nimport { firestoreDb } from './client';\n\nexport type PairingRequest = {\n  id: string;\n  code: string;\n  status: 'pending' | 'approved' | 'rejected' | 'expired';\n  createdAt: number;\n  updatedAt: number;\n  approvedInstanceId?: string;\n};\n\nfunction makeCode() {\n  // human-friendly-ish code\n  const a = Math.random().toString(36).slice(2, 6).toUpperCase();\n  const b = Math.random().toString(36).slice(2, 6).toUpperCase();\n  return `${a}-${b}`;\n}\n\nexport async function createPairingRequest(workspaceId: string): Promise<{ id: string; code: string }> {\n  const db = firestoreDb();\n  const code = makeCode();\n  const ref = await addDoc(collection(db, 'workspaces', workspaceId, 'pairingRequests'), {\n    code,\n    status: 'pending',\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  });\n  return { id: ref.id, code };\n}\n\nexport async function getPairingRequest(workspaceId: string, requestId: string) {\n  const db = firestoreDb();\n  const snap = await getDoc(doc(db, 'workspaces', workspaceId, 'pairingRequests', requestId));\n  if (!snap.exists()) return null;\n  return { id: snap.id, ...(snap.data() as Omit<PairingRequest, 'id'>) } as PairingRequest;\n}\n\nexport async function markApproved(workspaceId: string, requestId: string, instanceId: string) {\n  const db = firestoreDb();\n  await updateDoc(doc(db, 'workspaces', workspaceId, 'pairingRequests', requestId), {\n    status: 'approved',\n    approvedInstanceId: instanceId,\n    updatedAt: Date.now(),\n  });\n}\n","'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { onSnapshot, doc } from 'firebase/firestore';\nimport { firebaseAuth, firestoreDb } from '@/lib/firebase/client';\nimport { ensureUserAndWorkspace } from '@/lib/firebase/onboarding';\nimport { createPairingRequest } from '@/lib/firebase/pairing';\nimport { NavShell } from '@/app/components/NavShell';\n\nexport default function ConnectInstancePage() {\n  const router = useRouter();\n  const [loading, setLoading] = useState(true);\n  const [workspaceId, setWorkspaceId] = useState<string | null>(null);\n  const [code, setCode] = useState<string | null>(null);\n  const [status, setStatus] = useState<'pending' | 'approved' | 'rejected' | 'expired' | null>(null);\n\n  useEffect(() => {\n    (async () => {\n      const user = firebaseAuth().currentUser;\n      if (!user) {\n        router.replace('/sign-in');\n        return;\n      }\n      const { defaultWorkspaceId } = await ensureUserAndWorkspace(user);\n      setWorkspaceId(defaultWorkspaceId);\n      setLoading(false);\n    })();\n  }, [router]);\n\n  async function begin() {\n    if (!workspaceId) return;\n    const { id, code } = await createPairingRequest(workspaceId);\n    setCode(code);\n    setStatus('pending');\n\n    const db = firestoreDb();\n    return onSnapshot(doc(db, 'workspaces', workspaceId, 'pairingRequests', id), (snap) => {\n      const data = snap.data() as { status?: string } | undefined;\n      if (!data?.status) return;\n      if (data.status === 'pending' || data.status === 'approved' || data.status === 'rejected' || data.status === 'expired') {\n        setStatus(data.status);\n      }\n      if (data.status === 'approved') {\n        router.replace('/boards');\n      }\n    });\n  }\n\n  if (loading) {\n    return (\n      <main className=\"min-h-screen flex items-center justify-center p-6\">\n        <div className=\"panel p-4 text-[color:var(--muted)]\">Loading…</div>\n      </main>\n    );\n  }\n\n  return (\n    <NavShell title=\"Connect Bot\" showNav={false}>\n      <div className=\"panel p-5\">\n        <div className=\"text-sm text-[color:var(--muted)]\">Secure pairing</div>\n        <div className=\"mt-1 text-xl font-extrabold\">Generate a pairing code</div>\n        <div className=\"mt-2 text-sm text-[color:var(--muted)]\">\n          This avoids pasting secrets. You’ll approve the code inside your OpenClaw instance.\n        </div>\n\n        {!code ? (\n          <button onClick={begin} className=\"mt-4 w-full btn-primary px-4 py-3 rounded-2xl font-extrabold\">\n            Generate code\n          </button>\n        ) : (\n          <div className=\"mt-4\">\n            <div className=\"text-xs uppercase tracking-wide text-[color:var(--muted)] font-extrabold\">Pairing code</div>\n            <div className=\"mt-2 flex items-center gap-2\">\n              <div className=\"text-3xl font-black tracking-wider\">{code}</div>\n              <button\n                aria-label=\"Copy pairing code\"\n                title=\"Copy\"\n                onClick={async () => {\n                  try {\n                    await navigator.clipboard.writeText(code);\n                  } catch {\n                    // ignore\n                  }\n                }}\n                className=\"w-10 h-10 grid place-items-center rounded-xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.55)] text-[color:var(--muted)] hover:text-white\"\n              >\n                <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path d=\"M9 9h10v10H9V9Z\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinejoin=\"round\" />\n                  <path\n                    d=\"M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                  />\n                </svg>\n              </button>\n            </div>\n            <div className=\"mt-2 text-sm text-[color:var(--muted)]\">\n              In OpenClaw: approve this request (we’ll add the exact “Approve” UI next).\n            </div>\n            <div className=\"mt-4 flex items-center justify-between\">\n              <div className={`chip ${status === 'approved' ? 'chip-red' : ''}`}>Status: {status}</div>\n              <button\n                onClick={() => {\n                  setCode(null);\n                  setStatus(null);\n                }}\n                className=\"px-4 py-2 rounded-xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.55)] font-bold\"\n              >\n                New code\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </NavShell>\n  );\n}\n"],"names":["module","exports","require","vendored","React","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime","ReactServerDOMTurbopackClient"],"mappings":"6CAAAA,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEC,KAAK,8BCF9BJ,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACE,gBAAgB,+BCFvCL,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACG,kBAAkB,+BCFzCN,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACI,kBAAkB,+sBCwBjCP,EAAOC,OAAO,CAAGC,EAAQ,CAAA,CAAA,IAAA,iCC1BjCF,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEW,eAAe,8BCFxCd,GAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEY,6BAA6B,+ICFtD,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,MAEA,SAAS,IACP,OAAO,KAAK,GAAG,EACjB,CAMO,eAAe,EAAuB,CAAU,UACrD,IAAM,EAAK,CAAA,EAAA,EAAA,WAAA,AAAW,IAChB,EAAU,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAI,QAAS,EAAK,GAAG,EACnC,EAAW,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,GAE9B,GAAI,CAAC,EAAS,MAAM,GAAI,CACtB,IAAM,KAAW,EAAJ,AAAS,GAAG,EATnB,OAAK,GAUL,EAAQ,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAI,aAAc,GAyBpC,OAvBA,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,EAAO,CAClB,GAAI,EACJ,KAAM,CAAA,EAAG,EAAK,WAAW,EAAI,KAAK,UAAU,CAAC,CAC7C,UAAW,IACX,UAAW,GACb,GAEA,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAI,aAAc,EAAM,UAAW,EAAK,GAAG,EAAG,CAC7D,IAAK,EAAK,GAAG,CACb,KAAM,QACN,UAAW,GACb,GAEA,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,EAAS,CACpB,IAAK,EAAK,GAAG,CACb,MAAO,EAAK,KAAK,EAAI,KACrB,YAAa,EAAK,WAAW,EAAI,KACjC,SAAU,EAAK,QAAQ,EAAI,KAC3B,mBAAoB,EACpB,UAAW,IACX,UAAW,GACb,GAEO,CAAE,mBAAoB,CAAK,CACpC,CAEA,IAAM,EAAO,EAAS,IAAI,GAC1B,GAAI,CAAC,EAAK,kBAAkB,CAAE,CAC5B,IAAM,GAzCG,EAyCQ,CAzCG,CAyCP,AAAS,GAAG,CAxCpB,IAAI,EAAE,EAAA,CAAK,EA0ChB,OADA,MAAM,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,EAAS,CAAE,mBAAoB,EAAM,UAAW,GAAM,GAC/D,CAAE,mBAAoB,CAAK,CACpC,CAEA,MAAO,CAAE,mBAAoB,EAAK,kBAAkB,AAAC,CACvD,CAEO,eAAe,EAAqB,CAAmB,EAC5D,IAAM,EAAK,CAAA,EAAA,EAAA,WAAA,AAAW,IAChB,EAAI,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAI,aAAc,EAAa,aAAc,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,IAE9E,MAAO,CAAC,CADK,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,EACd,KAAK,AACpB,4FC9DA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MAkBO,eAAe,EAAqB,CAAmB,EAC5D,QAAM,EAAK,CAAA,EAAA,EAAA,WAAA,AAAW,IAChB,GAPA,EAAI,EAOG,GAPE,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,EAAG,GAAG,WAAW,GACtD,EAAI,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,EAAG,GAAG,WAAW,GACrD,CAAA,EAAG,EAAE,CAAC,EAAE,EAAA,CAAG,EAYlB,MAAO,CAAE,GAAI,CAND,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAI,aAAc,EAAa,mBAAoB,MACrF,EACA,OAAQ,UACR,UAAW,KAAK,GAAG,GACnB,UAAW,KAAK,GAAG,EACrB,EAAA,EACiB,EAAE,MAAE,CAAK,CAC5B,6EC3BA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACxD,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAC1C,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAyD,MAe7F,eAAe,IACb,GAAI,CAAC,EAAa,OAClB,GAAM,IAAE,CAAE,MAAE,CAAI,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,oBAAA,AAAoB,EAAC,GAChD,EAAQ,GACR,EAAU,WAEV,IAAM,EAAK,CAAA,EAAA,EAAA,WAAA,AAAW,IACtB,MAAO,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAI,aAAc,EAAa,kBAAmB,GAAK,AAAC,IAC5E,IAAM,EAAO,EAAK,IAAI,GACjB,GAAM,QAAQ,EACC,YAAhB,EAAK,MAAM,EAAkC,aAAhB,EAAK,MAAM,EAAmC,aAAhB,EAAK,MAAM,EAAmC,YAAhB,EAAK,MAAM,AAAK,GAAW,AACtH,EAAU,EAAK,MAAM,EAEH,YAAY,CAA5B,EAAK,MAAM,EACb,EAAO,OAAO,CAAC,WAEnB,EACF,OAEA,CAhCA,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KACR,CAAC,UACC,IAAM,EAAO,CAAA,EAAA,EAAA,YAAA,AAAY,IAAG,WAAW,CACvC,GAAI,CAAC,EAAM,OACT,EAAO,OAAO,CAAC,YAGjB,GAAM,CAAE,oBAAkB,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,sBAAA,AAAsB,EAAC,GAC5D,EAAe,GACf,GAAW,GACb,CAAC,EACH,EAAG,CAAC,EAAO,EAqBP,GAEA,CAAA,EAAA,EAAA,CAFS,EAET,EAAC,OAAA,CAAK,UAAU,6DACd,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CAAsC,eAMzD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,MAAM,cAAc,SAAS,WACrC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6CAAoC,mBACnD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uCAA8B,4BAC7C,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kDAAyC,wFAIvD,AAAC,EAKA,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oFAA2E,iBAC1F,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CAAsC,IACrD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,aAAW,oBACX,MAAM,OACN,QAAS,UACP,GAAI,CACF,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC,EACtC,CAAE,KAAM,CAER,CACF,EACA,UAAU,+JAEV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,OAAO,MAAM,uCAChE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,EAAE,kBAAkB,OAAO,eAAe,YAAY,IAAI,eAAe,UAC/E,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,EAAE,2DACF,OAAO,eACP,YAAY,IACZ,cAAc,kBAKtB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kDAAyC,+EAGxD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,CAAC,KAAK,EAAE,AAAW,eAAa,WAAa,GAAA,CAAI,WAAE,WAAS,KAC5E,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,KACP,EAAQ,MACR,EAAU,KACZ,EACA,UAAU,sGACX,mBA1CL,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,QAAS,EAAO,UAAU,wEAA+D,sBAmD3G","ignoreList":[0,1,2,3,4,5,6]}