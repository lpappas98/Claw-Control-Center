{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-dom.ts","../../../../src/lib/firebase/onboarding.ts","../../../../src/lib/firebase/useWorkspace.ts","../../../../src/lib/firebase/cards.ts","../../../../src/lib/firebase/cardsLive.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactDOM\n","import { collection, doc, getDoc, getDocs, limit, query, setDoc, updateDoc } from 'firebase/firestore';\nimport type { User } from 'firebase/auth';\nimport { firestoreDb } from './client';\n\nfunction now() {\n  return Date.now();\n}\n\nfunction wid(uid: string) {\n  return `ws_${uid}`;\n}\n\nexport async function ensureUserAndWorkspace(user: User) {\n  const db = firestoreDb();\n  const userRef = doc(db, 'users', user.uid);\n  const userSnap = await getDoc(userRef);\n\n  if (!userSnap.exists()) {\n    const wsId = wid(user.uid);\n    const wsRef = doc(db, 'workspaces', wsId);\n\n    await setDoc(wsRef, {\n      id: wsId,\n      name: `${user.displayName ?? 'My'} Workspace`,\n      createdAt: now(),\n      updatedAt: now(),\n    });\n\n    await setDoc(doc(db, 'workspaces', wsId, 'members', user.uid), {\n      uid: user.uid,\n      role: 'owner',\n      createdAt: now(),\n    });\n\n    await setDoc(userRef, {\n      uid: user.uid,\n      email: user.email ?? null,\n      displayName: user.displayName ?? null,\n      photoURL: user.photoURL ?? null,\n      defaultWorkspaceId: wsId,\n      createdAt: now(),\n      updatedAt: now(),\n    });\n\n    return { defaultWorkspaceId: wsId };\n  }\n\n  const data = userSnap.data() as { defaultWorkspaceId?: string };\n  if (!data.defaultWorkspaceId) {\n    const wsId = wid(user.uid);\n    await updateDoc(userRef, { defaultWorkspaceId: wsId, updatedAt: now() });\n    return { defaultWorkspaceId: wsId };\n  }\n\n  return { defaultWorkspaceId: data.defaultWorkspaceId };\n}\n\nexport async function workspaceHasInstance(workspaceId: string): Promise<boolean> {\n  const db = firestoreDb();\n  const q = query(collection(db, 'workspaces', workspaceId, 'instances'), limit(1));\n  const snap = await getDocs(q);\n  return !snap.empty;\n}\n","'use client';\n\nimport { useEffect, useState } from 'react';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { firebaseAuth } from './client';\nimport { ensureUserAndWorkspace } from './onboarding';\n\nfunction isE2EBypass() {\n  // Allow E2E bypass even under next start (NODE_ENV=production) *only* when explicitly enabled.\n  if (process.env.NODE_ENV === 'production' && process.env.NEXT_PUBLIC_E2E_BYPASS_AUTH !== '1') return false;\n  if (process.env.NEXT_PUBLIC_E2E_BYPASS_AUTH === '1') return true;\n  if (typeof window !== 'undefined') {\n    try {\n      return new URLSearchParams(window.location.search).get('e2e') === '1';\n    } catch {\n      return false;\n    }\n  }\n  return false;\n}\n\nexport function useWorkspace() {\n  const [workspaceId, setWorkspaceId] = useState<string | null>(() => (isE2EBypass() ? 'ws_e2e_user' : null));\n  const [authReady, setAuthReady] = useState<boolean>(() => (isE2EBypass() ? true : false));\n\n  useEffect(() => {\n    if (isE2EBypass()) return;\n\n    const unsub = onAuthStateChanged(firebaseAuth(), async (user) => {\n      if (!user) {\n        setWorkspaceId(null);\n        setAuthReady(true);\n        return;\n      }\n      const { defaultWorkspaceId } = await ensureUserAndWorkspace(user);\n      setWorkspaceId(defaultWorkspaceId);\n      setAuthReady(true);\n    });\n    return () => unsub();\n  }, []);\n\n  return { workspaceId, authReady };\n}\n","import { addDoc, collection, deleteDoc, doc, getDocs, orderBy, query, updateDoc } from 'firebase/firestore';\nimport { firestoreDb } from './client';\n\nexport type BlockOption = { id: string; label: string };\n\nexport type BlockPacket = {\n  status: 'blocked';\n  prompt: string;\n  options: BlockOption[];\n  requestedAt: number;\n  requestedByInstanceId?: string;\n};\n\nexport type UnblockAnswer = {\n  answeredAt: number;\n  answeredByUid?: string;\n  optionId?: string;\n  freeText?: string;\n  // Snapshot what the agent asked for (helps audit even if we clear `blocked`).\n  blockedPrompt?: string;\n  blockedOptions?: BlockOption[];\n};\n\nexport type ApprovalStatus = 'NOT_REQUESTED' | 'PENDING' | 'APPROVED' | 'CHANGES_REQUESTED';\n\nexport type ApprovalPacket = {\n  status: ApprovalStatus;\n  requestedAt?: number;\n  requestedByInstanceId?: string;\n  reviewedAt?: number;\n  reviewedByUid?: string;\n  note?: string;\n};\n\nexport type CardDoc = {\n  id: string;\n  boardId: string;\n  title: string;\n  description?: string;\n  priority: 'P0' | 'P1' | 'P2' | 'P3';\n  source: 'TARS' | 'Email' | 'Meeting' | 'Manual';\n  columnId: 'proposed' | 'queued' | 'doing' | 'review' | 'blocked' | 'done';\n  order: number;\n  artifacts?: unknown[];\n  approval?: ApprovalPacket;\n  blocked?: BlockPacket;\n  unblock?: UnblockAnswer;\n  startedDoingAt?: number;\n  movedToReviewAt?: number;\n  timeToReviewMs?: number;\n  reviewDecision?: {\n    outcome: 'approved' | 'changes_requested';\n    decidedAt: number;\n    decidedByUid?: string;\n    instructions?: string;\n  };\n  createdAt: number;\n  updatedAt: number;\n};\n\nfunction cardsRef(workspaceId: string, boardId: string) {\n  const db = firestoreDb();\n  return collection(db, 'workspaces', workspaceId, 'boards', boardId, 'cards');\n}\n\nexport async function listCards(workspaceId: string, boardId: string): Promise<CardDoc[]> {\n  const q = query(cardsRef(workspaceId, boardId), orderBy('order', 'asc'));\n  const snap = await getDocs(q);\n  return snap.docs.map((d) => ({ id: d.id, ...(d.data() as Omit<CardDoc, 'id'>) }));\n}\n\nexport async function createCard(\n  workspaceId: string,\n  boardId: string,\n  input: Omit<CardDoc, 'id' | 'createdAt' | 'updatedAt' | 'boardId'>\n) {\n  // Avoid composite-index requirements: default to time-based ordering.\n  // Reordering can override this later.\n  const ref = await addDoc(cardsRef(workspaceId, boardId), {\n    ...input,\n    boardId,\n    order: Date.now(),\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  });\n\n  return ref.id;\n}\n\nexport async function updateCard(\n  workspaceId: string,\n  boardId: string,\n  cardId: string,\n  patch: Record<string, unknown>\n) {\n  const db = firestoreDb();\n  await updateDoc(doc(db, 'workspaces', workspaceId, 'boards', boardId, 'cards', cardId), {\n    ...patch,\n    updatedAt: Date.now(),\n  });\n}\n\nexport async function deleteCard(workspaceId: string, boardId: string, cardId: string) {\n  const db = firestoreDb();\n  await deleteDoc(doc(db, 'workspaces', workspaceId, 'boards', boardId, 'cards', cardId));\n}\n","import { collection, onSnapshot, orderBy, query } from 'firebase/firestore';\nimport { firestoreDb } from './client';\nimport type { CardDoc } from './cards';\n\nexport function subscribeCards(workspaceId: string, boardId: string, cb: (cards: CardDoc[]) => void) {\n  const db = firestoreDb();\n  const q = query(collection(db, 'workspaces', workspaceId, 'boards', boardId, 'cards'), orderBy('order', 'asc'));\n  return onSnapshot(q, (snap) => {\n    cb(snap.docs.map((d) => ({ id: d.id, ...(d.data() as Omit<CardDoc, 'id'>) })));\n  });\n}\n"],"names":["module","exports","require","vendored","React","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime","ReactServerDOMTurbopackClient","ReactDOM"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7]}