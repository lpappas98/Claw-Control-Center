{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../src/lib/firebase/onboarding.ts","../../../../src/app/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","import { collection, doc, getDoc, getDocs, limit, query, setDoc, updateDoc } from 'firebase/firestore';\nimport type { User } from 'firebase/auth';\nimport { firestoreDb } from './client';\n\nfunction now() {\n  return Date.now();\n}\n\nfunction wid(uid: string) {\n  return `ws_${uid}`;\n}\n\nexport async function ensureUserAndWorkspace(user: User) {\n  const db = firestoreDb();\n  const userRef = doc(db, 'users', user.uid);\n  const userSnap = await getDoc(userRef);\n\n  if (!userSnap.exists()) {\n    const wsId = wid(user.uid);\n    const wsRef = doc(db, 'workspaces', wsId);\n\n    await setDoc(wsRef, {\n      id: wsId,\n      name: `${user.displayName ?? 'My'} Workspace`,\n      createdAt: now(),\n      updatedAt: now(),\n    });\n\n    await setDoc(doc(db, 'workspaces', wsId, 'members', user.uid), {\n      uid: user.uid,\n      role: 'owner',\n      createdAt: now(),\n    });\n\n    await setDoc(userRef, {\n      uid: user.uid,\n      email: user.email ?? null,\n      displayName: user.displayName ?? null,\n      photoURL: user.photoURL ?? null,\n      defaultWorkspaceId: wsId,\n      createdAt: now(),\n      updatedAt: now(),\n    });\n\n    return { defaultWorkspaceId: wsId };\n  }\n\n  const data = userSnap.data() as { defaultWorkspaceId?: string };\n  if (!data.defaultWorkspaceId) {\n    const wsId = wid(user.uid);\n    await updateDoc(userRef, { defaultWorkspaceId: wsId, updatedAt: now() });\n    return { defaultWorkspaceId: wsId };\n  }\n\n  return { defaultWorkspaceId: data.defaultWorkspaceId };\n}\n\nexport async function workspaceHasInstance(workspaceId: string): Promise<boolean> {\n  const db = firestoreDb();\n  const q = query(collection(db, 'workspaces', workspaceId, 'instances'), limit(1));\n  const snap = await getDocs(q);\n  return !snap.empty;\n}\n","'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { firebaseAuth } from '@/lib/firebase/client';\nimport { ensureUserAndWorkspace, workspaceHasInstance } from '@/lib/firebase/onboarding';\n\nexport default function Home() {\n  const router = useRouter();\n  const [status, setStatus] = useState<'loading' | 'noauth' | 'needs-onboarding' | 'ready'>('loading');\n\n  useEffect(() => {\n    const unsub = onAuthStateChanged(firebaseAuth(), async (user) => {\n      if (!user) {\n        setStatus('noauth');\n        router.replace('/sign-in');\n        return;\n      }\n\n      const { defaultWorkspaceId } = await ensureUserAndWorkspace(user);\n      const has = await workspaceHasInstance(defaultWorkspaceId);\n      if (!has) {\n        setStatus('needs-onboarding');\n        router.replace('/onboarding');\n        return;\n      }\n\n      setStatus('ready');\n      router.replace('/boards');\n    });\n\n    return () => unsub();\n  }, [router]);\n\n  return (\n    <main className=\"min-h-screen flex items-center justify-center p-6\">\n      <div className=\"panel p-4 text-[color:var(--muted)]\">{status === 'loading' ? 'Loading…' : 'Redirecting…'}</div>\n    </main>\n  );\n}\n"],"names":["module","exports","require","vendored","React","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime"],"mappings":"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","ignoreList":[0,1,2,3,4,5]}