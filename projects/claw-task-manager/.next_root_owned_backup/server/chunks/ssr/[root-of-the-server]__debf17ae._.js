module.exports=[72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},79826,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(8876);function d(){return Date.now()}async function e(a){var e,f;let g=(0,c.firestoreDb)(),h=(0,b.doc)(g,"users",a.uid),i=await (0,b.getDoc)(h);if(!i.exists()){let c=(e=a.uid,`ws_${e}`),f=(0,b.doc)(g,"workspaces",c);return await (0,b.setDoc)(f,{id:c,name:`${a.displayName??"My"} Workspace`,createdAt:d(),updatedAt:d()}),await (0,b.setDoc)((0,b.doc)(g,"workspaces",c,"members",a.uid),{uid:a.uid,role:"owner",createdAt:d()}),await (0,b.setDoc)(h,{uid:a.uid,email:a.email??null,displayName:a.displayName??null,photoURL:a.photoURL??null,defaultWorkspaceId:c,createdAt:d(),updatedAt:d()}),{defaultWorkspaceId:c}}let j=i.data();if(!j.defaultWorkspaceId){let c=(f=a.uid,`ws_${f}`);return await (0,b.updateDoc)(h,{defaultWorkspaceId:c,updatedAt:d()}),{defaultWorkspaceId:c}}return{defaultWorkspaceId:j.defaultWorkspaceId}}async function f(a){let d=(0,c.firestoreDb)(),e=(0,b.query)((0,b.collection)(d,"workspaces",a,"instances"),(0,b.limit)(1));return!(await (0,b.getDocs)(e)).empty}a.s(["ensureUserAndWorkspace",()=>e,"workspaceHasInstance",()=>f])},69583,a=>{"use strict";var b=a.i(72131);a.i(30485),a.i(31052),a.i(8876),a.i(79826);function c(){let[a,c]=(0,b.useState)(()=>"ws_e2e_user"),[d,e]=(0,b.useState)(()=>!0);return(0,b.useEffect)(()=>{},[]),{workspaceId:a,authReady:d}}a.s(["useWorkspace",()=>c])},46840,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(8876);async function d(a,d,e){let f;return(await (0,b.addDoc)((f=(0,c.firestoreDb)(),(0,b.collection)(f,"workspaces",a,"boards",d,"cards")),{...e,boardId:d,order:Date.now(),createdAt:Date.now(),updatedAt:Date.now()})).id}async function e(a,d,e,f){let g=(0,c.firestoreDb)();await (0,b.updateDoc)((0,b.doc)(g,"workspaces",a,"boards",d,"cards",e),{...f,updatedAt:Date.now()})}a.s(["createCard",()=>d,"updateCard",()=>e])},32455,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(8876);function d(a,d,e){let f=(0,c.firestoreDb)(),g=(0,b.query)((0,b.collection)(f,"workspaces",a,"boards",d,"cards"),(0,b.orderBy)("order","asc"));return(0,b.onSnapshot)(g,a=>{e(a.docs.map(a=>({id:a.id,...a.data()})))})}a.s(["subscribeCards",()=>d])},62640,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(97454),f=a.i(69583),g=a.i(32455),h=a.i(46840);let i={NOT_REQUESTED:["REQUEST_REVIEW"],PENDING:["APPROVE","REQUEST_CHANGES","RESET"],APPROVED:["REQUEST_REVIEW","RESET"],CHANGES_REQUESTED:["REQUEST_REVIEW","RESET"]};function j(a,b){return i[a].includes(b)}function k(a){return"NOT_REQUESTED"===a?"Not requested":"PENDING"===a?"Pending review":"APPROVED"===a?"Approved":"Changes requested"}a.i(69387);var l=a.i(60574),m=a.i(8876);function n({artifact:a}){return a.packet?.kind==="code"?(0,b.jsx)("pre",{className:"mt-2 max-h-[260px] overflow-auto rounded-xl border border-[color:var(--stroke)] bg-[rgba(10,12,16,.85)] p-3 text-xs",children:(0,b.jsx)("code",{children:a.packet.code})}):a.packet?.kind==="file"?(0,b.jsxs)("div",{className:"mt-2 rounded-xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.35)] p-3",children:[(0,b.jsx)("div",{className:"font-bold",children:a.packet.fileName}),(0,b.jsx)("div",{className:"mt-1 text-xs text-[color:var(--muted)]",children:(a.packet.mimeType||"Unknown type")+" • "+function(a){if(!a||a<=0)return"—";let b=["B","KB","MB","GB"],c=a,d=0;for(;c>=1024&&d<b.length-1;)c/=1024,d+=1;return`${c.toFixed(c>=10?0:1)} ${b[d]}`}(a.packet.sizeBytes)}),a.packet.url?(0,b.jsx)("a",{href:a.packet.url,target:"_blank",rel:"noreferrer",className:"mt-2 inline-block underline text-sm",children:"Open file"}):null]}):a.packet?.kind==="text"?(0,b.jsx)("div",{className:"mt-2 whitespace-pre-wrap text-sm text-[color:var(--text)]",children:a.packet.text}):a.content?.trim()?(0,b.jsx)("div",{className:"mt-2 whitespace-pre-wrap text-sm text-[color:var(--text)]",children:a.content}):(0,b.jsx)("div",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"No preview payload."})}function o({artifact:a,onUpdate:c}){return(0,b.jsxs)("div",{className:"card p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-extrabold",children:a.title}),(0,b.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:a.type})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:`chip ${"DRAFT"===a.state?"chip-red":""}`,children:a.state}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:["DRAFT","APPROVED","REJECTED"].map(d=>(0,b.jsx)("button",{onClick:()=>c({...a,state:d,updatedAt:Date.now()}),className:`px-2 py-1 rounded-lg border text-xs font-bold ${d===a.state?"border-[rgba(91,140,255,.65)] bg-[rgba(91,140,255,.18)]":"border-[color:var(--stroke)] bg-[rgba(22,26,34,.35)]"}`,children:d},d))})]})]}),(0,b.jsx)(n,{artifact:a})]})}function p(){let a=(0,c.useRouter)(),i=(0,c.useParams)(),n=decodeURIComponent(i.boardId),p=decodeURIComponent(i.taskId),{workspaceId:q}=(0,f.useWorkspace)(),[r,s]=(0,d.useState)(null),[t,u]=(0,d.useState)([]),[v,w]=(0,d.useState)(!1),[x,y]=(0,d.useState)(null),[z,A]=(0,d.useState)(""),[B,C]=(0,d.useState)(!1),[D,E]=(0,d.useState)(""),[F,G]=(0,d.useState)(!1);(0,d.useEffect)(()=>{if(!q)return;let a=(0,g.subscribeCards)(q,n,a=>{u(a),s(a.find(a=>a.id===p)??null),w(!0)});return()=>a()},[q,n,p]);let H=(0,d.useMemo)(()=>Array.isArray(r?.artifacts)?r.artifacts:[],[r]),I=(0,d.useMemo)(()=>H.filter(a=>"DRAFT"===a.state).length,[H]),J=r?.approval,K=J?.status??"NOT_REQUESTED";function L(){let a=t.filter(a=>"queued"===a.columnId).map(a=>a.order),b=a.length?Math.min(...a):NaN;return Number.isFinite(b)?b-1:Date.now()}async function M(a){if(!q||!r)return;let b={artifacts:H.map(b=>b.id===a.id?a:b)};"APPROVED"===K&&(b.approval={status:"NOT_REQUESTED",note:"Artifacts changed after approval."}),await (0,h.updateCard)(q,n,p,b)}async function N(a){if(q&&r&&j(K,a)){if(("REQUEST_REVIEW"===a||"APPROVE"===a)&&I>0)return void alert("All artifacts must leave DRAFT before review/approval.");G(!0);try{let b=(0,m.firebaseAuth)().currentUser?.uid,c=Date.now(),d=j(K,a)?"REQUEST_REVIEW"===a?"PENDING":"APPROVE"===a?"APPROVED":"REQUEST_CHANGES"===a?"CHANGES_REQUESTED":"NOT_REQUESTED":K,e=D.trim(),f={...J||{status:"NOT_REQUESTED"},status:d};"REQUEST_REVIEW"===a&&(f.requestedAt=c,e&&(f.note=e)),("APPROVE"===a||"REQUEST_CHANGES"===a)&&(f.reviewedAt=c,b&&(f.reviewedByUid=b),e&&(f.note=e)),"RESET"===a&&(f.note=e||void 0,f.requestedAt=void 0,f.reviewedAt=void 0,f.reviewedByUid=void 0);let g={approval:f};"REQUEST_REVIEW"===a&&"doing"===r.columnId&&(g.columnId="review",g.movedToReviewAt=c,"number"==typeof r.startedDoingAt&&c>=r.startedDoingAt&&(g.timeToReviewMs=c-r.startedDoingAt)),"APPROVE"===a&&"review"===r.columnId&&(g.columnId="done",g.reviewDecision={outcome:"approved",decidedAt:c,decidedByUid:b,instructions:e||void 0}),"REQUEST_CHANGES"===a&&"review"===r.columnId&&(g.columnId="queued",g.order=L(),g.reviewDecision={outcome:"changes_requested",decidedAt:c,decidedByUid:b,instructions:e||void 0}),await (0,h.updateCard)(q,n,p,g),E("")}finally{G(!1)}}}async function O(){if(!q||!r)return;let a=r.blocked,b=z.trim();if(!x&&!b)return void alert("Select an option or write a response.");let c=L();C(!0);try{let d=(0,m.firebaseAuth)().currentUser?.uid,e={answeredAt:Date.now()};d&&(e.answeredByUid=d),x&&(e.optionId=x),b&&(e.freeText=b),a?.prompt&&(e.blockedPrompt=a.prompt),Array.isArray(a?.options)&&(e.blockedOptions=a.options),await (0,h.updateCard)(q,n,p,{columnId:"queued",order:c,unblock:e,blocked:(0,l.deleteField)()}),y(null),A("")}catch(b){let a=b instanceof Error?b.message:String(b);alert(`Unblock failed: ${a}`)}finally{C(!1)}}return q?v&&!r?(0,b.jsxs)(e.NavShell,{title:"Task",children:[(0,b.jsx)("div",{className:"panel p-4 text-[color:var(--muted)]",children:"Task not found in this board."}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)("button",{onClick:()=>a.replace(`/board/${encodeURIComponent(n)}`),className:"btn-primary px-4 py-3 rounded-2xl font-extrabold",children:"Back to board"})})]}):r?(0,b.jsxs)(e.NavShell,{title:"Task",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:"Draft-only • approval gated"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"chip",children:["Drafts: ",I]}),(0,b.jsxs)("div",{className:`chip ${"APPROVED"===K?"":"chip-red"}`,children:["Approval: ",k(K)]})]})]}),(0,b.jsxs)("div",{className:"mt-4 panel p-4",children:[(0,b.jsx)("div",{className:"text-xl font-extrabold",children:r.title}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,b.jsx)("span",{className:`chip ${"P0"===r.priority||"P1"===r.priority?"chip-red":""}`,children:r.priority}),(0,b.jsxs)("span",{className:"chip",children:["Source: ",r.source]}),(0,b.jsxs)("span",{className:"chip",children:["Status: ",r.columnId]}),"number"==typeof r.timeToReviewMs?(0,b.jsxs)("span",{className:"chip",children:["Time to review: ",Math.max(0,Math.round(r.timeToReviewMs/6e4)),"m"]}):null]}),(0,b.jsxs)("div",{className:"mt-4 rounded-2xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.25)] p-4",children:[(0,b.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted)] font-extrabold",children:"Task approval"}),(0,b.jsx)("div",{className:"mt-2 text-sm",children:k(K)}),(0,b.jsx)("textarea",{value:D,onChange:a=>E(a.target.value),placeholder:"Optional review note…",className:"mt-3 w-full min-h-[80px] rounded-2xl bg-[rgba(11,12,15,.7)] border border-[color:var(--stroke)] p-3 outline-none"}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,b.jsx)("button",{disabled:F||!j(K,"REQUEST_REVIEW"),onClick:()=>void N("REQUEST_REVIEW"),className:"px-4 py-2 rounded-xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.55)] font-bold disabled:opacity-50",children:"Request review"}),(0,b.jsx)("button",{disabled:F||!j(K,"APPROVE"),onClick:()=>void N("APPROVE"),className:"btn-primary px-4 py-2 rounded-xl font-extrabold disabled:opacity-50",children:"Approve"}),(0,b.jsx)("button",{disabled:F||!j(K,"REQUEST_CHANGES"),onClick:()=>void N("REQUEST_CHANGES"),className:"px-4 py-2 rounded-xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.55)] font-bold disabled:opacity-50",children:"Request changes"}),(0,b.jsx)("button",{disabled:F||!j(K,"RESET"),onClick:()=>void N("RESET"),className:"px-4 py-2 rounded-xl border border-[color:var(--stroke)] bg-[rgba(22,26,34,.55)] font-bold disabled:opacity-50",children:"Reset"})]}),J?.note?(0,b.jsxs)("div",{className:"mt-2 text-xs text-[color:var(--muted)]",children:["Latest note: ",J.note]}):null,r.reviewDecision?.outcome==="changes_requested"&&r.reviewDecision.instructions?(0,b.jsxs)("div",{className:"mt-2 text-xs text-[color:var(--muted)]",children:["Latest change request: ",r.reviewDecision.instructions]}):null]}),"blocked"===r.columnId&&r.blocked?.status==="blocked"?(0,b.jsxs)("div",{className:"mt-4 rounded-2xl border border-[rgba(255,90,120,.35)] bg-[rgba(255,90,120,.08)] p-4",children:[(0,b.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted)] font-extrabold",children:"Needs from you"}),(0,b.jsx)("div",{className:"mt-2 font-bold",children:r.blocked.prompt}),Array.isArray(r.blocked.options)&&r.blocked.options.length?(0,b.jsx)("div",{className:"mt-3 grid gap-2",children:r.blocked.options.map(a=>(0,b.jsx)("button",{onClick:()=>y(a.id),"aria-pressed":x===a.id,"data-testid":`blocked-opt-${a.id}`,className:`px-4 py-3 rounded-2xl border font-extrabold text-left ${x===a.id?"border-[rgba(91,140,255,.65)] bg-[rgba(91,140,255,.18)]":"border-[color:var(--stroke)] bg-[rgba(22,26,34,.35)]"}`,children:a.label},a.id))}):null,(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted)] font-extrabold",children:"Or write a response"}),(0,b.jsx)("textarea",{value:z,onChange:a=>A(a.target.value),placeholder:"Type your answer…",className:"mt-1 w-full min-h-[90px] rounded-2xl bg-[rgba(11,12,15,.7)] border border-[color:var(--stroke)] p-4 outline-none"})]}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:"Submitting will move this card to the top of Queue."}),(0,b.jsx)("button",{disabled:B,onClick:()=>void O(),className:"btn-primary px-4 py-3 rounded-2xl font-extrabold disabled:opacity-50",children:B?"Submitting…":"Submit & Re-queue"})]})]}):null,(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted)] font-extrabold",children:"Description"}),(0,b.jsx)("div",{className:"mt-2 text-sm text-[color:var(--text)] whitespace-pre-wrap",children:r.description??"—"})]})]}),(0,b.jsxs)("div",{className:"mt-4 panel p-4",children:[(0,b.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted)] font-extrabold",children:"Artifacts"}),(0,b.jsx)("div",{className:"mt-3 grid gap-2",children:H.length?H.map(a=>(0,b.jsx)(o,{artifact:a,onUpdate:M},a.id)):(0,b.jsx)("div",{className:"text-[color:var(--muted)]",children:"No artifacts yet."})})]})]}):(0,b.jsx)(e.NavShell,{title:"Task",children:(0,b.jsx)("div",{className:"panel p-4 text-[color:var(--muted)]",children:"Loading…"})}):(0,b.jsx)(e.NavShell,{title:"Task",children:(0,b.jsx)("div",{className:"panel p-4 text-[color:var(--muted)]",children:"Loading…"})})}a.s(["default",()=>p],62640)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__debf17ae._.js.map